services:
  # ============================================================================
  # Test Database (Self-contained for MCP development)
  # ============================================================================
  test-db:
    image: postgres:16-alpine
    container_name: mcp_test_db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: openmcp_readonly
      POSTGRES_DB: test_db
    ports:
      - "5432:5432"
    volumes:
     # Creates user & dummy table for testing, can be modified as required
     - ${Postgres_Init_Script_PATH:-./tests/init-scripts}:${Init_Script:-/docker-entrypoint-initdb.d}
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 5s
      timeout: 5s
      retries: 5

  # MCP Server: PostgreSQL
  # ============================================================================
  mcp-postgres:
    image: ${MCP_POSTGRES_IMAGE:-openmcpserver/mcp-postgres:latest}
    container_name: mcp_postgres
    depends_on:
      test-db:
        condition: service_healthy
    environment:
      - PORT=8080
      # Connects to the local test-db defined above
      - DATABASE_URL=${DATABASE_URL:-postgres://openmcp_readonly:readonly_pass@test-db:5432/test_db}
      - POSTGRES_READ_ONLY=${POSTGRES_READ_ONLY:-true}
    ports:
      - "${PORT_POSTGRES:-8081}:8080"

  # MCP Server: FileSystem
  # ============================================================================
  mcp-filesystem:
    image: ${MCP_FILESYSTEM_IMAGE:-openmcpserver/mcp-filesystem:latest}
    container_name: mcp_filesystem
    environment:
      - PORT=8080
      - FILESYSTEM_ROOT=${FILESYSTEM_ROOT:-/data}
    volumes:
       # Maps a local 'sandbox' folder for safe testing
      - ${FILESYSTEM_HOST_PATH:-./sandbox}:${FILESYSTEM_ROOT:-/data}
    ports:
      - "${PORT_FILESYSTEM:-8082}:8080"

  # MCP Server: DuckDuckGo (Web Search)
  # ============================================================================
  mcp-duckduckgo:
    image: ${MCP_DUCKDUCKGO_IMAGE:-openmcpserver/mcp-duckduckgo:latest}
    container_name: mcp_duckduckgo
    environment:
      - PORT=8080
      - DDG_DEFAULT_MAX_RESULTS=${DDG_DEFAULT_MAX_RESULTS:-10}
    ports:
      - "${PORT_DUCKDUCKGO:-8083}:8080"
      